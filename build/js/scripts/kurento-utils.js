"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!function(f){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).kurentoUtils=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n||e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var freeice=require("freeice"),inherits=require("inherits"),UAParser=require("ua-parser-js"),uuid=require("uuid"),hark=require("hark"),EventEmitter=require("events").EventEmitter,recursive=require("merge").recursive.bind(void 0,!0),sdpTranslator=require("sdp-translator");try{require("kurento-browser-extensions")}catch(error){"undefined"==typeof getScreenConstraints&&(console.warn("screen sharing is not available"),getScreenConstraints=function(sendSource,callback){callback(new Error("This library is not enabled for screen sharing"))})}var MEDIA_CONSTRAINTS={audio:!0,video:{width:1280,framerate:15}},parser=new UAParser(window&&window.navigator?window.navigator.userAgent:""),browser=parser.getBrowser(),usePlanB=!1;function noop(error){error&&console.error(error)}function trackStop(track){track.stop&&track.stop()}function streamStop(stream){stream.getTracks().forEach(trackStop)}"Chrome"!==browser.name&&"Chromium"!==browser.name||(usePlanB=!0);var dumpSDP=function(description){return null==description?"":"type: "+description.type+"\r\n"+description.sdp};function bufferizeCandidates(pc,onerror){var candidatesQueue=[];return pc.addEventListener("signalingstatechange",function(){if("stable"===this.signalingState)for(;candidatesQueue.length;){var entry=candidatesQueue.shift();this.addIceCandidate(entry.candidate,entry.callback,entry.callback)}}),function(candidate,callback){switch(callback=callback||onerror,pc.signalingState){case"closed":callback(new Error("PeerConnection object is closed"));break;case"stable":if(pc.remoteDescription){pc.addIceCandidate(candidate,callback,callback);break}default:candidatesQueue.push({candidate:candidate,callback:callback})}}}function WebRtcPeer(mode,options,callback){if(!(this instanceof WebRtcPeer))return new WebRtcPeer(mode,options,callback);WebRtcPeer.super_.call(this),options instanceof Function&&(callback=options,options=void 0),options=options||{},callback=(callback||noop).bind(this);var localVideo=options.localVideo,remoteVideo=options.remoteVideo,videoStream=options.videoStream,audioStream=options.audioStream,mediaConstraints=options.mediaConstraints,connectionConstraints=options.connectionConstraints,pc=options.peerConnection,sendSource=options.sendSource||"webcam",guid=uuid.v4(),configuration=recursive({iceServers:freeice()},options.configuration),onstreamended=options.onstreamended;onstreamended&&this.on("streamended",onstreamended);var onicecandidate=options.onicecandidate;onicecandidate&&this.on("icecandidate",onicecandidate);var oncandidategatheringdone=options.oncandidategatheringdone;oncandidategatheringdone&&this.on("candidategatheringdone",oncandidategatheringdone);var simulcast=options.simulcast,multistream=options.multistream,interop=new sdpTranslator.Interop;pc||(pc=new RTCPeerConnection(configuration)),Object.defineProperties(this,{peerConnection:{get:function(){return pc}},id:{value:options.id||guid,writable:!1},remoteVideo:{get:function(){return remoteVideo}},localVideo:{get:function(){return localVideo}},currentFrame:{get:function(){if(remoteVideo){if(remoteVideo.readyState<remoteVideo.HAVE_CURRENT_DATA)throw new Error("No video stream data available");var canvas=document.createElement("canvas");return canvas.width=remoteVideo.videoWidth,canvas.height=remoteVideo.videoHeight,canvas.getContext("2d").drawImage(remoteVideo,0,0),canvas}}}});var self=this,candidatesQueueOut=[],candidategatheringdone=!1;pc.addEventListener("icecandidate",function(event){var cand,candidate=event.candidate;EventEmitter.listenerCount(self,"icecandidate")||EventEmitter.listenerCount(self,"candidategatheringdone")?candidate?(cand=multistream&&usePlanB?interop.candidateToUnifiedPlan(candidate):candidate,self.emit("icecandidate",cand),candidategatheringdone=!1):candidategatheringdone||(self.emit("candidategatheringdone"),candidategatheringdone=!0):candidategatheringdone||(candidatesQueueOut.push(candidate),candidate||(candidategatheringdone=!0))}),pc.onaddstream=options.onaddstream,pc.onnegotiationneeded=options.onnegotiationneeded,this.on("newListener",function(event,listener){if("icecandidate"===event||"candidategatheringdone"===event)for(;candidatesQueueOut.length;){var candidate=candidatesQueueOut.shift();!candidate==("candidategatheringdone"===event)&&listener(candidate)}});var addIceCandidate=bufferizeCandidates(pc);function setRemoteVideo(){if(remoteVideo){var stream=pc.getRemoteStreams()[0],url=stream?URL.createObjectURL(stream):"";remoteVideo.pause(),remoteVideo.src=url,remoteVideo.load(),console.log("Remote URL:",url)}}function mangleSdpToAddSimulcast(answer){var sdp,n;return simulcast&&("Chrome"===browser.name||"Chromium"===browser.name?(console.log("Adding multicast info"),answer=new RTCSessionDescription({type:answer.type,sdp:(sdp=answer.sdp,n=sdp.indexOf("a=ssrc-group:FID"),(0<n?sdp.slice(0,n):sdp)+function(videoStream){var videoTracks=videoStream.getVideoTracks();if(!videoTracks.length)return console.warn("No video tracks available in the video stream"),"";var lines=["a=x-google-flag:conference","a=ssrc-group:SIM 1 2 3","a=ssrc:1 cname:localVideo","a=ssrc:1 msid:"+videoStream.id+" "+videoTracks[0].id,"a=ssrc:1 mslabel:"+videoStream.id,"a=ssrc:1 label:"+videoTracks[0].id,"a=ssrc:2 cname:localVideo","a=ssrc:2 msid:"+videoStream.id+" "+videoTracks[0].id,"a=ssrc:2 mslabel:"+videoStream.id,"a=ssrc:2 label:"+videoTracks[0].id,"a=ssrc:3 cname:localVideo","a=ssrc:3 msid:"+videoStream.id+" "+videoTracks[0].id,"a=ssrc:3 mslabel:"+videoStream.id,"a=ssrc:3 label:"+videoTracks[0].id];return lines.push(""),lines.join("\n")}(videoStream))})):console.warn("Simulcast is only available in Chrome browser.")),answer}function streamEndedListener(){self.emit("streamended",this)}function start(){"closed"===pc.signalingState&&callback('The peer connection object is in "closed" state. This is most likely due to an invocation of the dispose method before accepting in the dialogue'),videoStream&&localVideo&&self.showLocalVideo(),videoStream&&(videoStream.addEventListener("ended",streamEndedListener),pc.addStream(videoStream)),audioStream&&(audioStream.addEventListener("ended",streamEndedListener),pc.addStream(audioStream));var browser=parser.getBrowser();"sendonly"!==mode||"Chrome"!==browser.name&&"Chromium"!==browser.name||39!==browser.major||(mode="sendrecv"),callback()}if(this.addIceCandidate=function(iceCandidate,callback){var candidate;candidate=multistream&&usePlanB?interop.candidateToPlanB(iceCandidate):new RTCIceCandidate(iceCandidate),console.log("ICE candidate received"),callback=(callback||noop).bind(this),addIceCandidate(candidate,callback)},this.setConstraints=function(width){MEDIA_CONSTRAINTS.video.width=width},this.generateOffer=function(callback){callback=callback.bind(this);var offerAudio=!0,offerVideo=!0;mediaConstraints&&(offerAudio="boolean"!=typeof mediaConstraints.audio||mediaConstraints.audio,offerVideo="boolean"!=typeof mediaConstraints.video||mediaConstraints.video);var browserDependantConstraints="Firefox"===browser.name&&34<browser.version?{offerToReceiveAudio:"sendonly"!==mode&&offerAudio,offerToReceiveVideo:"sendonly"!==mode&&offerVideo}:{mandatory:{OfferToReceiveAudio:"sendonly"!==mode&&offerAudio,OfferToReceiveVideo:"sendonly"!==mode&&offerVideo},optional:[{DtlsSrtpKeyAgreement:!0}]},constraints=recursive(browserDependantConstraints,connectionConstraints);console.log("constraints: "+JSON.stringify(constraints)),pc.createOffer(constraints).then(function(offer){return console.log("Created SDP offer"),offer=mangleSdpToAddSimulcast(offer),pc.setLocalDescription(offer)}).then(function(){var localDescription=pc.localDescription;console.log("Local description set",localDescription.sdp),multistream&&usePlanB&&(localDescription=interop.toUnifiedPlan(localDescription),console.log("offer::origPlanB->UnifiedPlan",dumpSDP(localDescription))),callback(null,localDescription.sdp,self.processAnswer.bind(self))}).catch(callback)},this.getLocalSessionDescriptor=function(){return pc.localDescription},this.getRemoteSessionDescriptor=function(){return pc.remoteDescription},this.showLocalVideo=function(){localVideo.src=URL.createObjectURL(videoStream),localVideo.muted=!0},this.processAnswer=function(sdpAnswer,callback){callback=(callback||noop).bind(this);var answer=new RTCSessionDescription({type:"answer",sdp:sdpAnswer});if(multistream&&usePlanB){var planBAnswer=interop.toPlanB(answer);console.log("asnwer::planB",dumpSDP(planBAnswer)),answer=planBAnswer}if(console.log("SDP answer received, setting remote description"),"closed"===pc.signalingState)return callback("PeerConnection is closed");pc.setRemoteDescription(answer,function(){setRemoteVideo(),callback()},callback)},this.processOffer=function(sdpOffer,callback){callback=callback.bind(this);var offer=new RTCSessionDescription({type:"offer",sdp:sdpOffer});if(multistream&&usePlanB){var planBOffer=interop.toPlanB(offer);console.log("offer::planB",dumpSDP(planBOffer)),offer=planBOffer}if(console.log("SDP offer received, setting remote description"),"closed"===pc.signalingState)return callback("PeerConnection is closed");pc.setRemoteDescription(offer).then(function(){return setRemoteVideo()}).then(function(){return pc.createAnswer()}).then(function(answer){return answer=mangleSdpToAddSimulcast(answer),console.log("Created SDP answer"),pc.setLocalDescription(answer)}).then(function(){var localDescription=pc.localDescription;multistream&&usePlanB&&(localDescription=interop.toUnifiedPlan(localDescription),console.log("answer::origPlanB->UnifiedPlan",dumpSDP(localDescription))),console.log("Local description set",localDescription.sdp),callback(null,localDescription.sdp)}).catch(callback)},"recvonly"===mode||videoStream||audioStream)setTimeout(start,0);else{var getMedia=function(constraints){void 0===constraints&&(constraints=MEDIA_CONSTRAINTS),getUserMedia(constraints,function(stream){videoStream=stream,start()},callback)};"webcam"===sendSource?getMedia(mediaConstraints):getScreenConstraints(sendSource,function(error,constraints_){if(error)return callback(error);constraints=[mediaConstraints],constraints.unshift(constraints_),getMedia(recursive.apply(void 0,constraints))},guid)}this.on("_dispose",function(){localVideo&&(localVideo.pause(),localVideo.src="",localVideo.load(),localVideo.muted=!1),remoteVideo&&(remoteVideo.pause(),remoteVideo.src="",remoteVideo.load()),self.removeAllListeners(),void 0!==window.cancelChooseDesktopMedia&&window.cancelChooseDesktopMedia(guid)})}function createEnableDescriptor(type){var method="get"+type+"Tracks";return{enumerable:!0,get:function(){if(this.peerConnection){var streams=this.peerConnection.getLocalStreams();if(streams.length){for(var stream,i=0;stream=streams[i];i++)for(var track,tracks=stream[method](),j=0;track=tracks[j];j++)if(!track.enabled)return!1;return!0}}},set:function(value){function trackSetEnable(track){track.enabled=value}this.peerConnection.getLocalStreams().forEach(function(stream){stream[method]().forEach(trackSetEnable)})}}}function WebRtcPeerRecvonly(options,callback){if(!(this instanceof WebRtcPeerRecvonly))return new WebRtcPeerRecvonly(options,callback);WebRtcPeerRecvonly.super_.call(this,"recvonly",options,callback)}function WebRtcPeerSendonly(options,callback){if(!(this instanceof WebRtcPeerSendonly))return new WebRtcPeerSendonly(options,callback);WebRtcPeerSendonly.super_.call(this,"sendonly",options,callback)}function WebRtcPeerSendrecv(options,callback){if(!(this instanceof WebRtcPeerSendrecv))return new WebRtcPeerSendrecv(options,callback);WebRtcPeerSendrecv.super_.call(this,"sendrecv",options,callback)}inherits(WebRtcPeer,EventEmitter),Object.defineProperties(WebRtcPeer.prototype,{enabled:{enumerable:!0,get:function(){return this.audioEnabled&&this.videoEnabled},set:function(value){this.audioEnabled=this.videoEnabled=value}},audioEnabled:createEnableDescriptor("Audio"),videoEnabled:createEnableDescriptor("Video")}),WebRtcPeer.prototype.getLocalStream=function(index){if(this.peerConnection)return this.peerConnection.getLocalStreams()[index||0]},WebRtcPeer.prototype.getRemoteStream=function(index){if(this.peerConnection)return this.peerConnection.getRemoteStreams()[index||0]},WebRtcPeer.prototype.dispose=function(){console.log("Disposing WebRtcPeer");var pc=this.peerConnection;try{if(pc){if("closed"===pc.signalingState)return;pc.getLocalStreams().forEach(streamStop),pc.close()}}catch(err){console.warn("Exception disposing webrtc peer "+err)}this.emit("_dispose")},inherits(WebRtcPeerRecvonly,WebRtcPeer),inherits(WebRtcPeerSendonly,WebRtcPeer),inherits(WebRtcPeerSendrecv,WebRtcPeer),exports.bufferizeCandidates=bufferizeCandidates,exports.WebRtcPeerRecvonly=WebRtcPeerRecvonly,exports.WebRtcPeerSendonly=WebRtcPeerSendonly,exports.WebRtcPeerSendrecv=WebRtcPeerSendrecv,exports.hark=function(stream,options){return hark(stream,options)}},{events:4,freeice:5,hark:8,inherits:9,"kurento-browser-extensions":10,merge:11,"sdp-translator":18,"ua-parser-js":21,uuid:23}],2:[function(require,module,exports){window.addEventListener&&(module.exports=require("./index"))},{"./index":3}],3:[function(require,module,exports){var WebRtcPeer=require("./WebRtcPeer");exports.WebRtcPeer=WebRtcPeer},{"./WebRtcPeer":1}],4:[function(require,module,exports){function EventEmitter(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function isFunction(arg){return"function"==typeof arg}function isObject(arg){return"object"===(void 0===arg?"undefined":_typeof(arg))&&null!==arg}function isUndefined(arg){return void 0===arg}((module.exports=EventEmitter).EventEmitter=EventEmitter).prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0,EventEmitter.defaultMaxListeners=10,EventEmitter.prototype.setMaxListeners=function(n){if("number"!=typeof n||n<0||isNaN(n))throw TypeError("n must be a positive number");return this._maxListeners=n,this},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,listeners;if(this._events||(this._events={}),"error"===type&&(!this._events.error||isObject(this._events.error)&&!this._events.error.length)){if((er=arguments[1])instanceof Error)throw er;throw TypeError('Uncaught, unspecified "error" event.')}if(isUndefined(handler=this._events[type]))return!1;if(isFunction(handler))switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];handler.apply(this,args)}else if(isObject(handler)){for(len=arguments.length,args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];for(len=(listeners=handler.slice()).length,i=0;i<len;i++)listeners[i].apply(this,args)}return!0},EventEmitter.prototype.on=EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction(listener))throw TypeError("listener must be a function");(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",type,isFunction(listener.listener)?listener.listener:listener),this._events[type]?isObject(this._events[type])?this._events[type].push(listener):this._events[type]=[this._events[type],listener]:this._events[type]=listener,isObject(this._events[type])&&!this._events[type].warned)&&((m=isUndefined(this._maxListeners)?EventEmitter.defaultMaxListeners:this._maxListeners)&&0<m&&this._events[type].length>m&&(this._events[type].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length),"function"==typeof console.trace&&console.trace()));return this},EventEmitter.prototype.once=function(type,listener){if(!isFunction(listener))throw TypeError("listener must be a function");var fired=!1;function g(){this.removeListener(type,g),fired||(fired=!0,listener.apply(this,arguments))}return g.listener=listener,this.on(type,g),this},EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i;if(!isFunction(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;if(length=(list=this._events[type]).length,position=-1,list===listener||isFunction(list.listener)&&list.listener===listener)delete this._events[type],this._events.removeListener&&this.emit("removeListener",type,listener);else if(isObject(list)){for(i=length;0<i--;)if(list[i]===listener||list[i].listener&&list[i].listener===listener){position=i;break}if(position<0)return this;1===list.length?(list.length=0,delete this._events[type]):list.splice(position,1),this._events.removeListener&&this.emit("removeListener",type,listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[type]&&delete this._events[type],this;if(0===arguments.length){for(key in this._events)"removeListener"!==key&&this.removeAllListeners(key);return this.removeAllListeners("removeListener"),this._events={},this}if(isFunction(listeners=this._events[type]))this.removeListener(type,listeners);else for(;listeners.length;)this.removeListener(type,listeners[listeners.length-1]);return delete this._events[type],this},EventEmitter.prototype.listeners=function(type){return this._events&&this._events[type]?isFunction(this._events[type])?[this._events[type]]:this._events[type].slice():[]},EventEmitter.listenerCount=function(emitter,type){return emitter._events&&emitter._events[type]?isFunction(emitter._events[type])?1:emitter._events[type].length:0}},{}],5:[function(require,module,exports){var normalice=require("normalice");module.exports=function(opts){var selected,servers={stun:(opts||{}).stun||require("./stun.json"),turn:(opts||{}).turn||require("./turn.json")},stunCount=(opts||{}).stunCount||2,turnCount=(opts||{}).turnCount||0;function getServers(type,count){for(var idx,out=[],input=[].concat(servers[type]);input.length&&out.length<count;)idx=Math.random()*input.length|0,out=out.concat(input.splice(idx,1));return out.map(function(url){return"string"==typeof url||url instanceof String?normalice(type+":"+url):url})}return selected=[].concat(getServers("stun",stunCount)),turnCount&&(selected=selected.concat(getServers("turn",turnCount))),selected}},{"./stun.json":6,"./turn.json":7,normalice:12}],6:[function(require,module,exports){module.exports=["stun.l.google.com:19302","stun1.l.google.com:19302","stun2.l.google.com:19302","stun3.l.google.com:19302","stun4.l.google.com:19302","stun.ekiga.net","stun.ideasip.com","stun.schlund.de","stun.stunprotocol.org:3478","stun.voiparound.com","stun.voipbuster.com","stun.voipstunt.com","stun.voxgratia.org","stun.services.mozilla.com"]},{}],7:[function(require,module,exports){module.exports=[]},{}],8:[function(require,module,exports){var WildEmitter=require("wildemitter");var audioContextType=window.AudioContext||window.webkitAudioContext,audioContext=null;module.exports=function(stream,options){var harker=new WildEmitter;if(!audioContextType)return harker;var sourceNode,fftBins,analyser,smoothing=(options=options||{}).smoothing||.1,interval=options.interval||50,threshold=options.threshold,play=options.play,history=options.history||10,running=!0;audioContext||(audioContext=new audioContextType),(analyser=audioContext.createAnalyser()).fftSize=512,analyser.smoothingTimeConstant=smoothing,fftBins=new Float32Array(analyser.fftSize),stream.jquery&&(stream=stream[0]),stream instanceof HTMLAudioElement||stream instanceof HTMLVideoElement?(sourceNode=audioContext.createMediaElementSource(stream),void 0===play&&(play=!0)):sourceNode=audioContext.createMediaStreamSource(stream),threshold=threshold||-50,sourceNode.connect(analyser),play&&analyser.connect(audioContext.destination),harker.speaking=!1,harker.setThreshold=function(t){threshold=t},harker.setInterval=function(i){interval=i},harker.stop=function(){running=!1,harker.emit("volume_change",-100,threshold),harker.speaking&&(harker.speaking=!1,harker.emit("stopped_speaking"))},harker.speakingHistory=[];for(var i=0;i<history;i++)harker.speakingHistory.push(0);return function looper(){setTimeout(function(){if(running){var currentVolume=function(analyser,fftBins){var maxVolume=-1/0;analyser.getFloatFrequencyData(fftBins);for(var i=4,ii=fftBins.length;i<ii;i++)fftBins[i]>maxVolume&&fftBins[i]<0&&(maxVolume=fftBins[i]);return maxVolume}(analyser,fftBins);harker.emit("volume_change",currentVolume,threshold);var history=0;if(threshold<currentVolume&&!harker.speaking){for(var i=harker.speakingHistory.length-3;i<harker.speakingHistory.length;i++)history+=harker.speakingHistory[i];2<=history&&(harker.speaking=!0,harker.emit("speaking"))}else if(currentVolume<threshold&&harker.speaking){for(i=0;i<harker.speakingHistory.length;i++)history+=harker.speakingHistory[i];0==history&&(harker.speaking=!1,harker.emit("stopped_speaking"))}harker.speakingHistory.shift(),harker.speakingHistory.push(0+(threshold<currentVolume)),looper()}},interval)}(),harker}},{wildemitter:24}],9:[function(require,module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},{}],10:[function(require,module,exports){},{}],11:[function(require,module,exports){!function(isNode){var Public=function(clone){return merge(!0===clone,!1,arguments)};function merge_recursive(base,extend){if("object"!==typeOf(base))return extend;for(var key in extend)"object"===typeOf(base[key])&&"object"===typeOf(extend[key])?base[key]=merge_recursive(base[key],extend[key]):base[key]=extend[key];return base}function merge(clone,recursive,argv){var result=argv[0],size=argv.length;(clone||"object"!==typeOf(result))&&(result={});for(var index=0;index<size;++index){var item=argv[index];if("object"===typeOf(item))for(var key in item){var sitem=clone?Public.clone(item[key]):item[key];result[key]=recursive?merge_recursive(result[key],sitem):sitem}}return result}function typeOf(input){return{}.toString.call(input).slice(8,-1).toLowerCase()}Public.recursive=function(clone){return merge(!0===clone,!0,arguments)},Public.clone=function(input){var index,size,output=input,type=typeOf(input);if("array"===type)for(output=[],size=input.length,index=0;index<size;++index)output[index]=Public.clone(input[index]);else if("object"===type)for(index in output={},input)output[index]=Public.clone(input[index]);return output},isNode?module.exports=Public:window.merge=Public}("object"===(void 0===module?"undefined":_typeof(module))&&module&&"object"===_typeof(module.exports)&&module.exports)},{}],12:[function(require,module,exports){var protocols=["stun:","turn:"];module.exports=function(input){var protocol,parts,url=(input||{}).url||input,output={};return"string"==typeof url||url instanceof String?(url=url.trim(),(protocol=protocols[protocols.indexOf(url.slice(0,5))])?(parts=(url=url.slice(5)).split("@"),output.username=input.username,output.credential=input.credential,1<parts.length&&(url=parts[1],parts=parts[0].split(":"),output.username=parts[0],output.credential=(input||{}).credential||parts[1]||""),output.url=protocol+url,output.urls=[output.url],output):input):input}},{}],13:[function(require,module,exports){var grammar=module.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(o){return o.encoding?"rtpmap:%d %s/%s/%s":o.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(o){return null!=o.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(o){return null!=o.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["value","uri","config"],format:function(o){return null!=o.config?"extmap:%s %s %s":"extmap:%s %s"}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(o){return null!=o.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation"],format:function(o){var str="candidate:%s %d %s %d %s %d typ %s";return str+=null!=o.raddr?" raddr %s rport %d":"%v%v",str+=null!=o.tcptype?" tcptype %s":"%v",null!=o.generation&&(str+=" generation %d"),str}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*):(.*)/,names:["id","attribute","value"],format:"ssrc:%d %s:%s"},{push:"ssrcGroups",reg:/^ssrc-group:(\w*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{push:"invalid",names:["value"]}]};Object.keys(grammar).forEach(function(key){grammar[key].forEach(function(obj){obj.reg||(obj.reg=/(.*)/),obj.format||(obj.format="%s")})})},{}],14:[function(require,module,exports){var parser=require("./parser"),writer=require("./writer");exports.write=writer,exports.parse=parser.parse,exports.parseFmtpConfig=parser.parseFmtpConfig,exports.parsePayloads=parser.parsePayloads,exports.parseRemoteCandidates=parser.parseRemoteCandidates},{"./parser":15,"./writer":16}],15:[function(require,module,exports){var toIntIfInt=function(v){return String(Number(v))===v?Number(v):v},parseReg=function(obj,location,content){var needsBlank=obj.name&&obj.names;obj.push&&!location[obj.push]?location[obj.push]=[]:needsBlank&&!location[obj.name]&&(location[obj.name]={});var keyLocation=obj.push?{}:needsBlank?location[obj.name]:location;!function(match,location,names,rawName){if(rawName&&!names)location[rawName]=toIntIfInt(match[1]);else for(var i=0;i<names.length;i+=1)null!=match[i+1]&&(location[names[i]]=toIntIfInt(match[i+1]))}(content.match(obj.reg),keyLocation,obj.names,obj.name),obj.push&&location[obj.push].push(keyLocation)},grammar=require("./grammar"),validLine=RegExp.prototype.test.bind(/^([a-z])=(.*)/);exports.parse=function(sdp){var session={},media=[],location=session;return sdp.split(/(\r\n|\r|\n)/).filter(validLine).forEach(function(l){var type=l[0],content=l.slice(2);"m"===type&&(media.push({rtp:[],fmtp:[]}),location=media[media.length-1]);for(var j=0;j<(grammar[type]||[]).length;j+=1){var obj=grammar[type][j];if(obj.reg.test(content))return parseReg(obj,location,content)}}),session.media=media,session};var fmtpReducer=function(acc,expr){var s=expr.split("=");return 2===s.length&&(acc[s[0]]=toIntIfInt(s[1])),acc};exports.parseFmtpConfig=function(str){return str.split(/\;\s?/).reduce(fmtpReducer,{})},exports.parsePayloads=function(str){return str.split(" ").map(Number)},exports.parseRemoteCandidates=function(str){for(var candidates=[],parts=str.split(" ").map(toIntIfInt),i=0;i<parts.length;i+=3)candidates.push({component:parts[i],ip:parts[i+1],port:parts[i+2]});return candidates}},{"./grammar":13}],16:[function(require,module,exports){var grammar=require("./grammar"),formatRegExp=/%[sdv%]/g,makeLine=function(type,obj,location){var args=[type+"="+(obj.format instanceof Function?obj.format(obj.push?location:location[obj.name]):obj.format)];if(obj.names)for(var i=0;i<obj.names.length;i+=1){var n=obj.names[i];obj.name?args.push(location[obj.name][n]):args.push(location[obj.names[i]])}else args.push(location[obj.name]);return function(formatStr){var i=1,args=arguments,len=args.length;return formatStr.replace(formatRegExp,function(x){if(len<=i)return x;var arg=args[i];switch(i+=1,x){case"%%":return"%";case"%s":return String(arg);case"%d":return Number(arg);case"%v":return""}})}.apply(null,args)},defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"];module.exports=function(session,opts){opts=opts||{},null==session.version&&(session.version=0),null==session.name&&(session.name=" "),session.media.forEach(function(mLine){null==mLine.payloads&&(mLine.payloads="")});var outerOrder=opts.outerOrder||defaultOuterOrder,innerOrder=opts.innerOrder||defaultInnerOrder,sdp=[];return outerOrder.forEach(function(type){grammar[type].forEach(function(obj){obj.name in session&&null!=session[obj.name]?sdp.push(makeLine(type,obj,session)):obj.push in session&&null!=session[obj.push]&&session[obj.push].forEach(function(el){sdp.push(makeLine(type,obj,el))})})}),session.media.forEach(function(mLine){sdp.push(makeLine("m",grammar.m[0],mLine)),innerOrder.forEach(function(type){grammar[type].forEach(function(obj){obj.name in mLine&&null!=mLine[obj.name]?sdp.push(makeLine(type,obj,mLine)):obj.push in mLine&&null!=mLine[obj.push]&&mLine[obj.push].forEach(function(el){sdp.push(makeLine(type,obj,el))})})})}),sdp.join("\r\n")+"\r\n"}},{"./grammar":13}],17:[function(require,module,exports){module.exports=function arrayEquals(array){if(!array)return!1;if(this.length!=array.length)return!1;for(var i=0,l=this.length;i<l;i++)if(this[i]instanceof Array&&array[i]instanceof Array){if(!arrayEquals.apply(this[i],[array[i]]))return!1}else if(this[i]!=array[i])return!1;return!0}},{}],18:[function(require,module,exports){exports.Interop=require("./interop")},{"./interop":19}],19:[function(require,module,exports){var transform=require("./transform"),arrayEquals=require("./array-equals");function Interop(){this.cache={mlB2UMap:{},mlU2BMap:{}}}(module.exports=Interop).prototype.candidateToUnifiedPlan=function(candidate){var cand=new RTCIceCandidate(candidate);return cand.sdpMLineIndex=this.cache.mlB2UMap[cand.sdpMLineIndex],cand},Interop.prototype.candidateToPlanB=function(candidate){var cand=new RTCIceCandidate(candidate);if(0===cand.sdpMid.indexOf("audio"))cand.sdpMid="audio";else{if(0!==cand.sdpMid.indexOf("video"))throw new Error("candidate with "+cand.sdpMid+" not allowed");cand.sdpMid="video"}return cand.sdpMLineIndex=this.cache.mlU2BMap[cand.sdpMLineIndex],cand},Interop.prototype.getFirstSendingIndexFromAnswer=function(type){if(!this.cache.answer)return null;var session=transform.parse(this.cache.answer);if(session&&session.media&&Array.isArray(session.media))for(var i=0;i<session.media.length;i++)if(session.media[i].type==type&&(!session.media[i].direction||"sendrecv"===session.media[i].direction||"sendonly"===session.media[i].direction))return i;return null},Interop.prototype.toPlanB=function(desc){var self=this;if("object"!==(void 0===desc?"undefined":_typeof(desc))||null===desc||"string"!=typeof desc.sdp)return console.warn("An empty description was passed as an argument."),desc;var session=transform.parse(desc.sdp);if(void 0===session.media||!Array.isArray(session.media)||0===session.media.length)return console.warn("The description has no media."),desc;if(session.media.length<=3&&session.media.every(function(m){return-1!==["video","audio","data"].indexOf(m.mid)}))return console.warn("This description does not look like Unified Plan."),desc;for(var sdp=desc.sdp,rewrite=!1,i=0;i<session.media.length;i++){session.media[i].rtp.forEach(function(rtp){if("NULL"===rtp.codec){rewrite=!0;var offer=transform.parse(self.cache.offer);rtp.codec=offer.media[i].rtp[0].codec}})}rewrite&&(sdp=transform.write(session)),this.cache[desc.type]=sdp;var media=session.media;session.media=[];var type2bl={},types=[];media.forEach(function(uLine){if(("string"!=typeof uLine.rtcpMux||"rtcp-mux"!==uLine.rtcpMux)&&"inactive"!==uLine.direction)throw new Error("Cannot convert to Plan B because m-lines without the rtcp-mux attribute were found.");void 0!==type2bl[uLine.type]&&"inactive"!==type2bl[uLine.type].direction||(type2bl[uLine.type]=uLine)}),media.forEach(function(uLine){if("application"===uLine.type)return session.media.push(uLine),void types.push(uLine.mid);"object"===_typeof(uLine.sources)&&Object.keys(uLine.sources).forEach(function(ssrc){"object"!==_typeof(type2bl[uLine.type].sources)&&(type2bl[uLine.type].sources={}),type2bl[uLine.type].sources[ssrc]=uLine.sources[ssrc],void 0!==uLine.msid&&(type2bl[uLine.type].sources[ssrc].msid=uLine.msid)}),void 0!==uLine.ssrcGroups&&Array.isArray(uLine.ssrcGroups)&&(void 0!==type2bl[uLine.type].ssrcGroups&&Array.isArray(type2bl[uLine.type].ssrcGroups)||(type2bl[uLine.type].ssrcGroups=[]),type2bl[uLine.type].ssrcGroups=type2bl[uLine.type].ssrcGroups.concat(uLine.ssrcGroups)),type2bl[uLine.type]===uLine&&(uLine.mid=uLine.type,delete uLine.bundleOnly,delete uLine.msid,"inactive"!==uLine.direction&&types.push(uLine.type),session.media.push(uLine))}),session.groups.some(function(group){if("BUNDLE"===group.type)return group.mids=types.join(" "),!0}),session.msidSemantic={semantic:"WMS",token:"*"};var resStr=transform.write(session);return new RTCSessionDescription({type:desc.type,sdp:resStr})},Interop.prototype.toUnifiedPlan=function(desc){var self=this;if("object"!==(void 0===desc?"undefined":_typeof(desc))||null===desc||"string"!=typeof desc.sdp)return console.warn("An empty description was passed as an argument."),desc;var session=transform.parse(desc.sdp);if(void 0===session.media||!Array.isArray(session.media)||0===session.media.length)return console.warn("The description has no media."),desc;if(3<session.media.length||!session.media.every(function(m){return-1!==["video","audio","data"].indexOf(m.mid)}))return console.warn("This description does not look like Plan B."),desc;var mids=[];session.media.forEach(function(m){mids.push(m.mid)});var type,cached,hasBundle=!1;if(void 0!==session.groups&&Array.isArray(session.groups)&&(hasBundle=session.groups.every(function(g){return"BUNDLE"!==g.type||arrayEquals.apply(g.mids.sort(),[mids.sort()])})),!hasBundle)throw new Error("Cannot convert to Unified Plan because m-lines that are not bundled were found.");if("answer"===desc.type)type="offer";else{if("offer"!==desc.type)throw new Error("Type '"+desc.type+"' not supported.");type="answer"}void 0!==this.cache[type]&&(cached=transform.parse(this.cache[type]));var candidates,iceUfrag,icePwd,fingerprint,recvonlySsrcs={audio:{},video:{}},mid2ul={},bIdx=0,uIdx=0,sources2ul={},payloads={},rtcpFb={},rtp={};if(session.media.forEach(function(bLine){if(("string"!=typeof bLine.rtcpMux||"rtcp-mux"!==bLine.rtcpMux)&&"inactive"!==bLine.direction)throw new Error("Cannot convert to Unified Plan because m-lines without the rtcp-mux attribute were found.");if("application"!==bLine.type){var sources=bLine.sources,ssrcGroups=bLine.ssrcGroups,port=bLine.port;if(void 0!==candidates&&void 0!==bLine.candidates&&candidates!=bLine.candidates)throw new Error("Only BUNDLE supported, candidates must be the same for all m-lines.\n\tLast candidates: "+JSON.stringify(candidates)+"\n\tNew candidates: "+JSON.stringify(bLine.candidates));if("undefined"!=bLine.candidates&&(candidates=bLine.candidates),void 0!==iceUfrag&&void 0!==bLine.iceUfrag&&iceUfrag!=bLine.iceUfrag)throw new Error("Only BUNDLE supported, iceUfrag must be the same for all m-lines.\n\tLast iceUfrag: "+iceUfrag+"\n\tNew iceUfrag: "+bLine.iceUfrag);if("undefined"!=bLine.iceUfrag&&(iceUfrag=bLine.iceUfrag),void 0!==icePwd&&void 0!==bLine.icePwd&&icePwd!=bLine.icePwd)throw new Error("Only BUNDLE supported, icePwd must be the same for all m-lines.\n\tLast icePwd: "+icePwd+"\n\tNew icePwd: "+bLine.icePwd);if("undefined"!=bLine.icePwd&&(icePwd=bLine.icePwd),void 0!==fingerprint&&void 0!==bLine.fingerprint&&(fingerprint.type!=bLine.fingerprint.type||fingerprint.hash!=bLine.fingerprint.hash))throw new Error("Only BUNDLE supported, fingerprint must be the same for all m-lines.\n\tLast fingerprint: "+JSON.stringify(fingerprint)+"\n\tNew fingerprint: "+JSON.stringify(bLine.fingerprint));"undefined"!=bLine.fingerprint&&(fingerprint=bLine.fingerprint),payloads[bLine.type]=bLine.payloads,rtcpFb[bLine.type]=bLine.rtcpFb,rtp[bLine.type]=bLine.rtp;var ssrc2group={};void 0!==ssrcGroups&&Array.isArray(ssrcGroups)&&ssrcGroups.forEach(function(ssrcGroup){void 0!==ssrcGroup.ssrcs&&Array.isArray(ssrcGroup.ssrcs)&&ssrcGroup.ssrcs.forEach(function(ssrc){void 0===ssrc2group[ssrc]&&(ssrc2group[ssrc]=[]),ssrc2group[ssrc].push(ssrcGroup)})});var ssrc2ml={};if("object"===(void 0===sources?"undefined":_typeof(sources)))delete bLine.sources,delete bLine.ssrcGroups,delete bLine.candidates,delete bLine.iceUfrag,delete bLine.icePwd,delete bLine.fingerprint,delete bLine.port,delete bLine.mid,Object.keys(sources).forEach(function(ssrc){var uLine;"offer"!==desc.type||sources[ssrc].msid?(void 0!==ssrc2group[ssrc]&&Array.isArray(ssrc2group[ssrc])&&ssrc2group[ssrc].some(function(ssrcGroup){return ssrcGroup.ssrcs.some(function(related){if("object"===_typeof(ssrc2ml[related]))return uLine=ssrc2ml[related],!0})}),"object"===(void 0===uLine?"undefined":_typeof(uLine))?(uLine.sources[ssrc]=sources[ssrc],delete sources[ssrc].msid):(uLine=Object.create(bLine),ssrc2ml[ssrc]=uLine,void 0!==sources[ssrc].msid&&(uLine.msid=sources[ssrc].msid,delete sources[ssrc].msid),uLine.sources={},uLine.sources[ssrc]=sources[ssrc],uLine.ssrcGroups=ssrc2group[ssrc],void 0!==cached&&void 0!==cached.media&&Array.isArray(cached.media)&&cached.media.forEach(function(m){"object"===_typeof(m.sources)&&Object.keys(m.sources).forEach(function(s){s===ssrc&&(uLine.mid=m.mid)})}),void 0===uLine.mid&&(uLine.mid=[bLine.type,"-",ssrc].join("")),uLine.candidates=candidates,uLine.iceUfrag=iceUfrag,uLine.icePwd=icePwd,uLine.fingerprint=fingerprint,uLine.port=port,mid2ul[uLine.mid]=uLine,sources2ul[uIdx]=uLine.sources,self.cache.mlU2BMap[uIdx]=bIdx,void 0===self.cache.mlB2UMap[bIdx]&&(self.cache.mlB2UMap[bIdx]=uIdx),uIdx++)):recvonlySsrcs[bLine.type][ssrc]=sources[ssrc]});else{var uLine=bLine;uLine.candidates=candidates,uLine.iceUfrag=iceUfrag,uLine.icePwd=icePwd,uLine.fingerprint=fingerprint,uLine.port=port,mid2ul[uLine.mid]=uLine,self.cache.mlU2BMap[uIdx]=bIdx,void 0===self.cache.mlB2UMap[bIdx]&&(self.cache.mlB2UMap[bIdx]=uIdx)}bIdx++}else mid2ul[bLine.mid]=bLine}),session.media=[],mids=[],"answer"===desc.type)for(var i=0;i<cached.media.length;i++){var uLine=cached.media[i];void 0===mid2ul[uLine.mid]&&(delete uLine.msid,delete uLine.sources,delete uLine.ssrcGroups,void 0===sources2ul[i]&&(uLine.direction&&"sendrecv"!==uLine.direction?"sendonly"===uLine.direction&&(uLine.direction="inactive"):uLine.direction="recvonly"),uLine.sources=sources2ul[i],uLine.candidates=candidates,uLine.iceUfrag=iceUfrag,uLine.icePwd=icePwd,uLine.fingerprint=fingerprint,uLine.rtp=rtp[uLine.type],uLine.payloads=payloads[uLine.type],uLine.rtcpFb=rtcpFb[uLine.type]),session.media.push(uLine),"string"==typeof uLine.mid&&mids.push(uLine.mid)}else void 0!==cached&&void 0!==cached.media&&Array.isArray(cached.media)&&cached.media.forEach(function(uLine){mids.push(uLine.mid),void 0!==mid2ul[uLine.mid]?session.media.push(mid2ul[uLine.mid]):(delete uLine.msid,delete uLine.sources,delete uLine.ssrcGroups,uLine.direction&&"sendrecv"!==uLine.direction||(uLine.direction="recvonly"),uLine.direction&&"sendonly"!==uLine.direction||(uLine.direction="inactive"),session.media.push(uLine))}),Object.keys(mid2ul).forEach(function(mid){if(-1===mids.indexOf(mid))if(mids.push(mid),"recvonly"===mid2ul[mid].direction){var done=!1;session.media.some(function(uLine){if(("sendrecv"===uLine.direction||"sendonly"===uLine.direction)&&uLine.type===mid2ul[mid].type)return Object.keys(mid2ul[mid].sources).forEach(function(ssrc){uLine.sources[ssrc]=mid2ul[mid].sources[ssrc]}),done=!0}),done||session.media.push(mid2ul[mid])}else session.media.push(mid2ul[mid])});["audio","video"].forEach(function(type){if(session&&session.media&&Array.isArray(session.media)){var idx=null;if(0<Object.keys(recvonlySsrcs[type]).length&&null===(idx=self.getFirstSendingIndexFromAnswer(type)))for(var i=0;i<session.media.length;i++)if(session.media[i].type===type){idx=i;break}if(idx&&session.media.length>idx){var mLine=session.media[idx];Object.keys(recvonlySsrcs[type]).forEach(function(ssrc){mLine.sources&&mLine.sources[ssrc]&&console.warn("Replacing an existing SSRC."),mLine.sources||(mLine.sources={}),mLine.sources[ssrc]=recvonlySsrcs[type][ssrc]})}}}),session.groups.some(function(group){if("BUNDLE"===group.type)return group.mids=mids.join(" "),!0}),session.msidSemantic={semantic:"WMS",token:"*"};var resStr=transform.write(session);return this.cache[desc.type]=resStr,new RTCSessionDescription({type:desc.type,sdp:resStr})}},{"./array-equals":17,"./transform":20}],20:[function(require,module,exports){var transform=require("sdp-transform");exports.write=function(session,opts){return void 0!==session&&void 0!==session.media&&Array.isArray(session.media)&&session.media.forEach(function(mLine){void 0!==mLine.sources&&0!==Object.keys(mLine.sources).length&&(mLine.ssrcs=[],Object.keys(mLine.sources).forEach(function(ssrc){var source=mLine.sources[ssrc];Object.keys(source).forEach(function(attribute){mLine.ssrcs.push({id:ssrc,attribute:attribute,value:source[attribute]})})}),delete mLine.sources),void 0!==mLine.ssrcGroups&&Array.isArray(mLine.ssrcGroups)&&mLine.ssrcGroups.forEach(function(ssrcGroup){void 0!==ssrcGroup.ssrcs&&Array.isArray(ssrcGroup.ssrcs)&&(ssrcGroup.ssrcs=ssrcGroup.ssrcs.join(" "))})}),void 0!==session&&void 0!==session.groups&&Array.isArray(session.groups)&&session.groups.forEach(function(g){void 0!==g.mids&&Array.isArray(g.mids)&&(g.mids=g.mids.join(" "))}),transform.write(session,opts)},exports.parse=function(sdp){var session=transform.parse(sdp);return void 0!==session&&void 0!==session.media&&Array.isArray(session.media)&&session.media.forEach(function(mLine){void 0!==mLine.ssrcs&&Array.isArray(mLine.ssrcs)&&(mLine.sources={},mLine.ssrcs.forEach(function(ssrc){mLine.sources[ssrc.id]||(mLine.sources[ssrc.id]={}),mLine.sources[ssrc.id][ssrc.attribute]=ssrc.value}),delete mLine.ssrcs),void 0!==mLine.ssrcGroups&&Array.isArray(mLine.ssrcGroups)&&mLine.ssrcGroups.forEach(function(ssrcGroup){"string"==typeof ssrcGroup.ssrcs&&(ssrcGroup.ssrcs=ssrcGroup.ssrcs.split(" "))})}),void 0!==session&&void 0!==session.groups&&Array.isArray(session.groups)&&session.groups.forEach(function(g){"string"==typeof g.mids&&(g.mids=g.mids.split(" "))}),session}},{"sdp-transform":14}],21:[function(require,module,exports){!function(window,undefined){var MODEL="model",NAME="name",TYPE="type",VENDOR="vendor",VERSION="version",MOBILE="mobile",TABLET="tablet",util={extend:function(regexes,extensions){for(var i in extensions)-1!=="browser cpu device engine os".indexOf(i)&&extensions[i].length%2==0&&(regexes[i]=extensions[i].concat(regexes[i]));return regexes},has:function(str1,str2){return"string"==typeof str1&&-1!==str2.toLowerCase().indexOf(str1.toLowerCase())},lowerize:function(str){return str.toLowerCase()},major:function(version){return"string"===(void 0===version?"undefined":_typeof(version))?version.split(".")[0]:void 0}},mapper={rgx:function(){for(var result,j,k,p,q,matches,match,i=0,args=arguments;i<args.length&&!matches;){var regex=args[i],props=args[i+1];if("undefined"===(void 0===result?"undefined":_typeof(result)))for(p in result={},props)props.hasOwnProperty(p)&&("object"===(void 0===(q=props[p])?"undefined":_typeof(q))?result[q[0]]=void 0:result[q]=void 0);for(j=k=0;j<regex.length&&!matches;)if(matches=regex[j++].exec(this.getUA()))for(p=0;p<props.length;p++)match=matches[++k],"object"===(void 0===(q=props[p])?"undefined":_typeof(q))&&0<q.length?2==q.length?"function"==_typeof(q[1])?result[q[0]]=q[1].call(this,match):result[q[0]]=q[1]:3==q.length?"function"!==_typeof(q[1])||q[1].exec&&q[1].test?result[q[0]]=match?match.replace(q[1],q[2]):void 0:result[q[0]]=match?q[1].call(this,match,q[2]):void 0:4==q.length&&(result[q[0]]=match?q[3].call(this,match.replace(q[1],q[2])):void 0):result[q]=match||void 0;i+=2}return result},str:function(_str,map){for(var i in map)if("object"===_typeof(map[i])&&0<map[i].length){for(var j=0;j<map[i].length;j++)if(util.has(map[i][j],_str))return"?"===i?void 0:i}else if(util.has(map[i],_str))return"?"===i?void 0:i;return _str}},maps={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},regexes={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[NAME,VERSION],[/\s(opr)\/([\w\.]+)/i],[[NAME,"Opera"],VERSION],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?([\w\.]*)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs)\/([\w\.-]+)/i],[NAME,VERSION],[/(trident).+rv[:\s]([\w\.]+).+like\sgecko/i],[[NAME,"IE"],VERSION],[/(edge)\/((\d+)?[\w\.]+)/i],[NAME,VERSION],[/(yabrowser)\/([\w\.]+)/i],[[NAME,"Yandex"],VERSION],[/(comodo_dragon)\/([\w\.]+)/i],[[NAME,/_/g," "],VERSION],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i,/(qqbrowser)[\/\s]?([\w\.]+)/i],[NAME,VERSION],[/(uc\s?browser)[\/\s]?([\w\.]+)/i,/ucweb.+(ucbrowser)[\/\s]?([\w\.]+)/i,/JUC.+(ucweb)[\/\s]?([\w\.]+)/i],[[NAME,"UCBrowser"],VERSION],[/(dolfin)\/([\w\.]+)/i],[[NAME,"Dolphin"],VERSION],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[NAME,"Chrome"],VERSION],[/XiaoMi\/MiuiBrowser\/([\w\.]+)/i],[VERSION,[NAME,"MIUI Browser"]],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)/i],[VERSION,[NAME,"Android Browser"]],[/FBAV\/([\w\.]+);/i],[VERSION,[NAME,"Facebook"]],[/fxios\/([\w\.-]+)/i],[VERSION,[NAME,"Firefox"]],[/version\/([\w\.]+).+?mobile\/\w+\s(safari)/i],[VERSION,[NAME,"Mobile Safari"]],[/version\/([\w\.]+).+?(mobile\s?safari|safari)/i],[VERSION,NAME],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[NAME,[VERSION,mapper.str,maps.browser.oldsafari.version]],[/(konqueror)\/([\w\.]+)/i,/(webkit|khtml)\/([\w\.]+)/i],[NAME,VERSION],[/(navigator|netscape)\/([\w\.-]+)/i],[[NAME,"Netscape"],VERSION],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/([\w\.-]+)/i,/(mozilla)\/([\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]+)*/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[NAME,VERSION]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[["architecture","amd64"]],[/(ia32(?=;))/i],[["architecture",util.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[["architecture","ia32"]],[/windows\s(ce|mobile);\sppc;/i],[["architecture","arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[["architecture",/ower/,"",util.lowerize]],[/(sun4\w)[;\)]/i],[["architecture","sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[["architecture",util.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[MODEL,VENDOR,[TYPE,TABLET]],[/applecoremedia\/[\w\.]+ \((ipad)/],[MODEL,[VENDOR,"Apple"],[TYPE,TABLET]],[/(apple\s{0,1}tv)/i],[[MODEL,"Apple TV"],[VENDOR,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[MODEL,[VENDOR,"Amazon"],[TYPE,TABLET]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[MODEL,mapper.str,maps.device.amazon.model],[VENDOR,"Amazon"],[TYPE,MOBILE]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[MODEL,VENDOR,[TYPE,MOBILE]],[/\((ip[honed|\s\w*]+);/i],[MODEL,[VENDOR,"Apple"],[TYPE,MOBILE]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/\(bb10;\s(\w+)/i],[MODEL,[VENDOR,"BlackBerry"],[TYPE,MOBILE]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[MODEL,[VENDOR,"Asus"],[TYPE,TABLET]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[VENDOR,"Sony"],[MODEL,"Xperia Tablet"],[TYPE,TABLET]],[/(?:sony)?(?:(?:(?:c|d)\d{4})|(?:so[-l].+))\sbuild\//i],[[VENDOR,"Sony"],[MODEL,"Xperia Phone"],[TYPE,MOBILE]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[VENDOR,MODEL,[TYPE,"console"]],[/android.+;\s(shield)\sbuild/i],[MODEL,[VENDOR,"Nvidia"],[TYPE,"console"]],[/(playstation\s[34portablevi]+)/i],[MODEL,[VENDOR,"Sony"],[TYPE,"console"]],[/(sprint\s(\w+))/i],[[VENDOR,mapper.str,maps.device.sprint.vendor],[MODEL,mapper.str,maps.device.sprint.model],[TYPE,MOBILE]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[VENDOR,MODEL,[TYPE,TABLET]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[VENDOR,[MODEL,/_/g," "],[TYPE,MOBILE]],[/(nexus\s9)/i],[MODEL,[VENDOR,"HTC"],[TYPE,TABLET]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[MODEL,[VENDOR,"Microsoft"],[TYPE,"console"]],[/(kin\.[onetw]{3})/i],[[MODEL,/\./g," "],[VENDOR,"Microsoft"],[TYPE,MOBILE]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w+)*/i,/(XT\d{3,4}) build\//i,/(nexus\s[6])/i],[MODEL,[VENDOR,"Motorola"],[TYPE,MOBILE]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[MODEL,[VENDOR,"Motorola"],[TYPE,TABLET]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[VENDOR,"Samsung"],MODEL,[TYPE,TABLET]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[VENDOR,"Samsung"],MODEL,[TYPE,MOBILE]],[/(samsung);smarttv/i],[VENDOR,MODEL,[TYPE,"smarttv"]],[/\(dtv[\);].+(aquos)/i],[MODEL,[VENDOR,"Sharp"],[TYPE,"smarttv"]],[/sie-(\w+)*/i],[MODEL,[VENDOR,"Siemens"],[TYPE,MOBILE]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[VENDOR,"Nokia"],MODEL,[TYPE,MOBILE]],[/android\s3\.[\s\w;-]{10}(a\d{3})/i],[MODEL,[VENDOR,"Acer"],[TYPE,TABLET]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[VENDOR,"LG"],MODEL,[TYPE,TABLET]],[/(lg) netcast\.tv/i],[VENDOR,MODEL,[TYPE,"smarttv"]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[MODEL,[VENDOR,"LG"],[TYPE,MOBILE]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[MODEL,[VENDOR,"Lenovo"],[TYPE,TABLET]],[/linux;.+((jolla));/i],[VENDOR,MODEL,[TYPE,MOBILE]],[/((pebble))app\/[\d\.]+\s/i],[VENDOR,MODEL,[TYPE,"wearable"]],[/android.+;\s(glass)\s\d/i],[MODEL,[VENDOR,"Google"],[TYPE,"wearable"]],[/android.+(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]*note?[\s_]*(?:\d\w)?)\s+build/i,/android.+(mi[\s\-_]*(?:one|one[\s_]plus)?[\s_]*(?:\d\w)?)\s+build/i],[[MODEL,/_/g," "],[VENDOR,"Xiaomi"],[TYPE,MOBILE]],[/\s(tablet)[;\/\s]/i,/\s(mobile)[;\/\s]/i],[[TYPE,util.lowerize],VENDOR,MODEL]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[VERSION,[NAME,"EdgeHTML"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[NAME,VERSION],[/rv\:([\w\.]+).*(gecko)/i],[VERSION,NAME]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[NAME,VERSION],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[NAME,[VERSION,mapper.str,maps.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[NAME,"Windows"],[VERSION,mapper.str,maps.os.windows.version]],[/\((bb)(10);/i],[[NAME,"BlackBerry"],VERSION],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[NAME,VERSION],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[NAME,"Symbian"],VERSION],[/\((series40);/i],[NAME],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[NAME,"Firefox OS"],VERSION],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[NAME,VERSION],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[NAME,"Chromium OS"],VERSION],[/(sunos)\s?([\w\.]+\d)*/i],[[NAME,"Solaris"],VERSION],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[NAME,VERSION],[/(ip[honead]+)(?:.*os\s([\w]+)*\slike\smac|;\sopera)/i],[[NAME,"iOS"],[VERSION,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[NAME,"Mac OS"],[VERSION,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[NAME,VERSION]]},UAParser=function UAParser(uastring,extensions){if(!(this instanceof UAParser))return new UAParser(uastring,extensions).getResult();var ua=uastring||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:""),rgxmap=extensions?util.extend(regexes,extensions):regexes;return this.getBrowser=function(){var browser=mapper.rgx.apply(this,rgxmap.browser);return browser.major=util.major(browser.version),browser},this.getCPU=function(){return mapper.rgx.apply(this,rgxmap.cpu)},this.getDevice=function(){return mapper.rgx.apply(this,rgxmap.device)},this.getEngine=function(){return mapper.rgx.apply(this,rgxmap.engine)},this.getOS=function(){return mapper.rgx.apply(this,rgxmap.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return ua},this.setUA=function(uastring){return ua=uastring,this},this.setUA(ua),this};UAParser.VERSION="0.7.10",UAParser.BROWSER={NAME:NAME,MAJOR:"major",VERSION:VERSION},UAParser.CPU={ARCHITECTURE:"architecture"},UAParser.DEVICE={MODEL:MODEL,VENDOR:VENDOR,TYPE:TYPE,CONSOLE:"console",MOBILE:MOBILE,SMARTTV:"smarttv",TABLET:TABLET,WEARABLE:"wearable",EMBEDDED:"embedded"},UAParser.ENGINE={NAME:NAME,VERSION:VERSION},UAParser.OS={NAME:NAME,VERSION:VERSION},"undefined"!==(void 0===exports?"undefined":_typeof(exports))?("undefined"!==(void 0===module?"undefined":_typeof(module))&&module.exports&&(exports=module.exports=UAParser),exports.UAParser=UAParser):window.UAParser=UAParser;var $=window.jQuery||window.Zepto;if("undefined"!==(void 0===$?"undefined":_typeof($))){var parser=new UAParser;$.ua=parser.getResult(),$.ua.get=function(){return parser.getUA()},$.ua.set=function(uastring){parser.setUA(uastring);var result=parser.getResult();for(var prop in result)$.ua[prop]=result[prop]}}}("object"===("undefined"==typeof window?"undefined":_typeof(window))?window:this)},{}],22:[function(require,module,exports){(function(global){var rng;if(global.crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);rng=function(){return crypto.getRandomValues(_rnds8),_rnds8}}if(!rng){var _rnds=new Array(16);rng=function(){for(var r,i=0;i<16;i++)0==(3&i)&&(r=4294967296*Math.random()),_rnds[i]=r>>>((3&i)<<3)&255;return _rnds}}module.exports=rng}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],23:[function(require,module,exports){for(var _rng=require("./rng"),_byteToHex=[],_hexToByte={},i=0;i<256;i++)_byteToHex[i]=(i+256).toString(16).substr(1),_hexToByte[_byteToHex[i]]=i;function unparse(buf,offset){var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+"-"+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]}var _seedBytes=_rng(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0;function v4(options,buf,offset){var i=buf&&offset||0;"string"==typeof options&&(buf="binary"==options?new Array(16):null,options=null);var rnds=(options=options||{}).random||(options.rng||_rng)();if(rnds[6]=15&rnds[6]|64,rnds[8]=63&rnds[8]|128,buf)for(var ii=0;ii<16;ii++)buf[i+ii]=rnds[ii];return buf||unparse(rnds)}var uuid=v4;uuid.v1=function(options,buf,offset){var i=buf&&offset||0,b=buf||[],clockseq=void 0!==(options=options||{}).clockseq?options.clockseq:_clockseq,msecs=void 0!==options.msecs?options.msecs:(new Date).getTime(),nsecs=void 0!==options.nsecs?options.nsecs:_lastNSecs+1,dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&void 0===options.clockseq&&(clockseq=clockseq+1&16383),(dt<0||_lastMSecs<msecs)&&void 0===options.nsecs&&(nsecs=0),1e4<=nsecs)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=msecs,_clockseq=clockseq;var tl=(1e4*(268435455&(msecs+=122192928e5))+(_lastNSecs=nsecs))%4294967296;b[i++]=tl>>>24&255,b[i++]=tl>>>16&255,b[i++]=tl>>>8&255,b[i++]=255&tl;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255,b[i++]=255&tmh,b[i++]=tmh>>>24&15|16,b[i++]=tmh>>>16&255,b[i++]=clockseq>>>8|128,b[i++]=255&clockseq;for(var node=options.node||_nodeId,n=0;n<6;n++)b[i+n]=node[n];return buf||unparse(b)},uuid.v4=v4,uuid.parse=function(s,buf,offset){var i=buf&&offset||0,ii=0;for(buf=buf||[],s.toLowerCase().replace(/[0-9a-f]{2}/g,function(oct){ii<16&&(buf[i+ii++]=_hexToByte[oct])});ii<16;)buf[i+ii++]=0;return buf},uuid.unparse=unparse,module.exports=uuid},{"./rng":22}],24:[function(require,module,exports){function WildEmitter(){}(module.exports=WildEmitter).mixin=function(constructor){var prototype=constructor.prototype||constructor;prototype.isWildEmitter=!0,prototype.on=function(event,groupName,fn){this.callbacks=this.callbacks||{};var hasGroup=3===arguments.length,group=hasGroup?groupName:void 0,func=hasGroup?fn:groupName;return func._groupName=group,(this.callbacks[event]=this.callbacks[event]||[]).push(func),this},prototype.once=function(event,groupName,fn){var self=this,hasGroup=3===arguments.length,group=hasGroup?groupName:void 0,func=hasGroup?fn:groupName;return this.on(event,group,function on(){self.off(event,on),func.apply(this,arguments)}),this},prototype.releaseGroup=function(groupName){var item,i,len,handlers;for(item in this.callbacks=this.callbacks||{},this.callbacks)for(i=0,len=(handlers=this.callbacks[item]).length;i<len;i++)handlers[i]._groupName===groupName&&(handlers.splice(i,1),i--,len--);return this},prototype.off=function(event,fn){this.callbacks=this.callbacks||{};var i,callbacks=this.callbacks[event];return callbacks&&(1===arguments.length?delete this.callbacks[event]:(i=callbacks.indexOf(fn),callbacks.splice(i,1),0===callbacks.length&&delete this.callbacks[event])),this},prototype.emit=function(event){this.callbacks=this.callbacks||{};var i,len,listeners,args=[].slice.call(arguments,1),callbacks=this.callbacks[event],specialCallbacks=this.getWildcardCallbacks(event);if(callbacks)for(i=0,len=(listeners=callbacks.slice()).length;i<len&&listeners[i];++i)listeners[i].apply(this,args);if(specialCallbacks)for(len=specialCallbacks.length,i=0,len=(listeners=specialCallbacks.slice()).length;i<len&&listeners[i];++i)listeners[i].apply(this,[event].concat(args));return this},prototype.getWildcardCallbacks=function(eventName){this.callbacks=this.callbacks||{};var item,split,result=[];for(item in this.callbacks)split=item.split("*"),("*"===item||2===split.length&&eventName.slice(0,split[0].length)===split[0])&&(result=result.concat(this.callbacks[item]));return result}},WildEmitter.mixin(WildEmitter)},{}]},{},[2])(2)});