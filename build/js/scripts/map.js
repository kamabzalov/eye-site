"use strict";var pos,markerCluster,map,flag=!1,isStreet=!1,isCompany=!1,isUsers=!1,markersArray=[],filteredArray=[],lock=!1,styles=[{url:"/img/cluster.png",width:30,height:30,backgroundPosition:"0,0",textColor:"#fff",textSize:10}];function initMap(){(map=new google.maps.Map(document.getElementById("map"),{disableDefaultUI:!0,zoom:14,styles:[{featureType:"water",elementType:"geometry.fill",stylers:[{color:"#d3d3d3"}]},{featureType:"transit",stylers:[{color:"#808080"},{visibility:"off"}]},{featureType:"road.highway",elementType:"geometry.stroke",stylers:[{visibility:"on"},{color:"#b3b3b3"}]},{featureType:"road.highway",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.local",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ffffff"},{weight:1.8}]},{featureType:"road.local",elementType:"geometry.stroke",stylers:[{color:"#d7d7d7"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#ebebeb"}]},{featureType:"administrative",elementType:"geometry",stylers:[{color:"#a7a7a7"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"road.arterial",elementType:"geometry.fill",stylers:[{color:"#ffffff"}]},{featureType:"landscape",elementType:"geometry.fill",stylers:[{visibility:"on"},{color:"#efefef"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#696969"}]},{featureType:"administrative",elementType:"labels.text.fill",stylers:[{visibility:"on"},{color:"#737373"}]},{featureType:"poi",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"road.arterial",elementType:"geometry.stroke",stylers:[{color:"#d6d6d6"}]},{featureType:"road",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"geometry.fill",stylers:[{color:"#dadada"}]}]})).addListener("dragend",function(){getMarkers(map)}),map.addListener("zoom_changed",function(){getMarkers(map)}),google.maps.event.addListener(map,"dragstart",function(){angular.element("#panel").addClass("hide")});var you_pos="/img/black-dot.png";you_pos=new google.maps.Marker({map:map,icon:you_pos});navigator.geolocation?navigator.geolocation.getCurrentPosition(function(position){pos={lat:position.coords.latitude,lng:position.coords.longitude},you_pos.setPosition(pos),map.setCenter(pos)},function(){handleLocationError(!0,you_pos,map.getCenter())}):(handleLocationError(!1,you_pos,map.getCenter()),pos={lat:0,lng:0},you_pos.setPosition(pos),map.setCenter(pos))}function codeAddress(id){var geocoder=new google.maps.Geocoder,address=document.getElementById(id).value;geocoder.geocode({address:address},function(results,status){localStorage.setItem("lat",results[0].geometry.location.lat()),localStorage.setItem("lng",results[0].geometry.location.lng())})}function makeAutoComplete(selector){var input=document.getElementById(selector);new google.maps.places.Autocomplete(input)}function handleLocationError(browserHasGeolocation,infoWindow,pos){you_pos.setPosition(pos),you_pos.setContent(browserHasGeolocation?"Error: The Geolocation service failed.":"Error: Your browser doesn't support geolocation.")}function getMarkers(map){var bounds=map.getBounds(),ne=bounds.getNorthEast(),sw=bounds.getSouthWest(),settings={async:!0,crossDomain:!0,url:"https://api.eyeinc.ru/v0.9/index.php?c=api&m=mapsearchNew&southWestLat="+sw.lat()+"&southWestLng="+sw.lng()+"&northEastLat="+ne.lat()+"&northEastLng="+ne.lng(),method:"GET"};lock||(lock=!0,$.ajax(settings).done(function(response){lock=!1,response.success&&(markersArray=response.search,isStreet||isUsers||isCompany?filter(markersArray):setMarkers(markersArray))}))}function setMarkers(marks){initMarkers(marks,function(){}),setTop(marks,function(){})}function initMarkers(search,callback){for(var markers=search.map(function(location,i){if(location.lat=parseFloat(location.lat),location.lng=parseFloat(location.lng),0==search[i].type)var icon="/img/green-dot.png";else if(1==search[i].type)icon="/img/orange-dot.png";else icon="/img/blue-dot.png";return new google.maps.Marker({position:location,id:location.id,icon:icon})}),windowContent=[],infoWindow=[],j=0;j<markers.length;j++){var avatar=0==search[j].avatar.length?"<span class='empty-avatar'></span>":0==search.type?search[j].avatar:"<img src='"+search[j].avatar+"'/>";windowContent[j]="<div class='eye-infoWindow'>"+avatar+" "+search[j].name+"</div>",infoWindow[j]=new google.maps.InfoWindow({content:windowContent[j]});infoWindow[j];google.maps.event.addListener(infoWindow[j],"domready",function(){$(".gm-style-iw").prev().children(":nth-child(2)").hide(),$(".gm-style-iw").prev().children(":nth-child(4)").hide(),$(".gm-style-iw").next().css("display","none")}),markers[j].addListener("click",function(){angular.element(document.body).scope().getUserDataById(this.id)});!function(j){google.maps.event.addListener(markers[j],"mouseover",function(){infoWindow[j].open(map,this)}),google.maps.event.addListener(markers[j],"mouseout",function(){infoWindow[j].close()})}(j),$(".eye-infoWindow img").outerWidth()&&"undefined"!=$(".eye-infoWindow img").outerWidth()||$(".eye-infoWindow img").replaceWith("<span class='empty-avatar'></span>")}void 0!==markerCluster&&markerCluster.clearMarkers(),markerCluster=new MarkerClusterer(map,markers,{imagePath:"/img/black-dot.png",styles:styles}),callback()}function filter(param){switch(param){case"isUsers":isUsers=!isUsers;break;case"isCompany":isCompany=!isCompany;break;case"isStreet":isStreet=!isStreet}var k=0;filteredArray=[];for(var i=0;i<markersArray.length;i++)isStreet&&0==markersArray[i].type||isUsers&&1==markersArray[i].type||isCompany&&2==markersArray[i].type||(filteredArray[k]=markersArray[i],k++);setMarkers(filteredArray)}function compareTranslation(translationA,translationB){return translationA.likes+translationA.watchers+translationA.followers-(translationB.likes+translationB.watchers+translationB.followers)}