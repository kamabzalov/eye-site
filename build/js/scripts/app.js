"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}var eyeApp=angular.module("eye",["ngRoute","ngWebSocket","ngAnimate","pascalprecht.translate","infinite-scroll"]),LEFTASIDEWIDTH=250,INFOPANELWIDTH=250,RIGHTASIDEWIDTH=310,MOBILELEFTASIDEWIDTH=55;function Socket(){angular.extend(this)}eyeApp.config(function($httpProvider){$httpProvider.defaults.useXDomain=!0,delete $httpProvider.defaults.headers.common["X-Requested-With"]}),eyeApp.config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix(""),window.history&&window.history.pushState&&$locationProvider.html5Mode(!0)}]),eyeApp.config(["$sceDelegateProvider",function($sceDelegateProvider){$sceDelegateProvider.resourceUrlWhitelist(["self","https://api.eyeinc.ru/v0.9/index.php"])}]),eyeApp.config(["$translateProvider",function($translateProvider){var _$translateProvider$t,_$translateProvider$t2;$translateProvider.translations("en_US",(_defineProperty(_$translateProvider$t={TITLE:"EYE - look at the world",LOGIN:"Login",LOGOUT:"Logout",REGISTRATION:"Registration",MESSAGES:"Messages",STARTTRANSLATE:"Start streaming",STOPTRANSLATE:"Stop streaming",STOPWATCHTRANSLATE:"Exit from streaming",MYCAMERAS:"My cameras",ADDCAMERA:"Add camera",MYWALL:"Wall",WALL:"Wall",FAVORITES:"Favorites",FOLLOWERS:"Followers",SETTINGS:"Settings",SEARCH:"Search",TOSUBSCRIBE:"Subscribe",UNSUBSCRIBE:"Unsubscribe",PEOPLE:"people",COMPANIES:"companies",PLACES:"places",PLACEHOLDERLOGIN:"Phone/Email",PLACEHOLDERPASSWORD:"Password",FORGOTPASSWORD:"Forgot password?",REGNEWUSER:"Register new user",REMEMBERPASS:"Remember password",CHOOSEREMEMBERPASS:"Choose remember password way",NEXTBUTTON:"Next",NOTERECEIVECODE:"If you didn't receive code after 60 seconds",TRYMORE:"try again",PLACEHOLDERCODE:"Enter the code",PLACEHOLDERNEWPASSWORD:"New password",SAVEBUTTON:"Save",ENTERNEWPASSWORD:"Enter new password",USER:"User",COMPANY:"Company",REGISTERNOTICE:"Registering in our service you get access to our services and agree with",TERMSOFUSE:"terms of use",PLACEHOLDERUSERNAME:"User name",PLACEHOLDERPHONE:" Phone",PLACEHOLDEREMAIL:"Email",START:"Start",REGNEWCOMPANY:"Register new company",SENDCODETOEMAIL:"Send code to email",PLACEHOLDERCOMPANYNAME:"Company name",PLACEHOLDERREPEATPASSWORD:"Repeat password",PLACEHOLDERCALLS:"Phone for receiving calls",PLACEHOLDERADDRESS:"Address",CHOOSECATEGORY:"Choose category",NIGHTCLUB:"Night club",BAR:"Bar",KARAOKE:"Karaoke",CAFE:"Cafe",RESTAURANT:"Restaurant",HOOKAH:"Hookah",HOSTEL:"Hostel",HOTEL:"Hotel",FITNESS:"Fitness",FASHION:"Fashion",ART:"Art",GAMES:"Games",AQUAPARK:"Aquapark",SERVICE:"Service","SHOPPING CENTER":"Shopping center",SHOP:"Shop","BUSINESS CENTER":"Business center","KINDERGARTEN CENTER":"Kindergarten center",EDUCATION:"Education",MEDICINE:"Medicine",CHANNEL:"Channel",PRIVATE:"Private","NO CATEGORY":"No category",DOWNLOADWINDOWS:"Download app for windows",DOWNLOADMAC:"Download app for Mac",SEARCHBYDIALOGS:"Search by dialogs",SEARCHBYFAVORITES:"Search by favorites",SEARCHBYFOLLOWERS:"Search by followers"},"ADDCAMERA","Add camera"),_defineProperty(_$translateProvider$t,"ADDCAMERANOTICE","If you use static IP address, add your camera URL to form and manage your streaming through mobile app"),_defineProperty(_$translateProvider$t,"PLACEHOLDERCAMERAURL","Camera URL"),_defineProperty(_$translateProvider$t,"PLACEHOLDERCAMERAURL","Camera URL"),_defineProperty(_$translateProvider$t,"PLACEHOLDERCAMERANAME","Camera name"),_defineProperty(_$translateProvider$t,"ADDBUTTON","Add camera"),_defineProperty(_$translateProvider$t,"SEARCHBYCAMERAS","Search by cameras"),_defineProperty(_$translateProvider$t,"WALLNOTICE","Here you can add advertising or poster of future events"),_defineProperty(_$translateProvider$t,"ADDWALL","Add wall"),_defineProperty(_$translateProvider$t,"PLACEHOLDERWALLCREATETEXT","Enter the text"),_defineProperty(_$translateProvider$t,"CREATEWALL","Create wall"),_defineProperty(_$translateProvider$t,"EDITWALL","Edite wall"),_defineProperty(_$translateProvider$t,"UPDATEWALL","Update wall"),_defineProperty(_$translateProvider$t,"DELETEWALL","Delete wall"),_defineProperty(_$translateProvider$t,"ANSWERTO","Answer"),_defineProperty(_$translateProvider$t,"WATCHERSCOUNT","watchers"),_defineProperty(_$translateProvider$t,"WRITECOMMENT","Write comment"),_defineProperty(_$translateProvider$t,"DOWNLOAD","Download"),_defineProperty(_$translateProvider$t,"DOWNLOADEYESTREAMER","Download EyeStreamer"),_defineProperty(_$translateProvider$t,"DOWNLOADFORWINDOWS","Download for Windows"),_defineProperty(_$translateProvider$t,"DOWNLOADFORMAC","Download for Mac"),_defineProperty(_$translateProvider$t,"CHANGEPASSWORD","Change password"),_defineProperty(_$translateProvider$t,"CHANGELOGINANDAVATAR","Change login and avatar"),_defineProperty(_$translateProvider$t,"ENTEROLDPASSWORD","Enter old password"),_defineProperty(_$translateProvider$t,"ENTERNEWPASSWORD","Enter new password"),_defineProperty(_$translateProvider$t,"ENTERLOGIN","Enter login"),_defineProperty(_$translateProvider$t,"CHANGEBUTTON","Change"),_$translateProvider$t)),$translateProvider.translations("ru_RU",(_defineProperty(_$translateProvider$t2={TITLE:"EYE - посмотри на мир",LOGIN:"Вход",LOGOUT:"Выход",REGISTRATION:"Регистрация",MESSAGES:"Сообщения",MYCAMERAS:"Мои камеры",STARTTRANSLATE:"Начать трансляцию",STOPTRANSLATE:"Закончить трансляцию",STOPWATCHTRANSLATE:"Выйти из трансляции",ADDCAMERA:"Добавить камеру",MYWALL:"Моя стена",WALL:"Стена",FAVORITES:"Избранные",FOLLOWERS:"Подписчики",SETTINGS:"Настройки",SEARCH:"Поиск",TOSUBSCRIBE:"Подписаться",UNSUBSCRIBE:"Подписки",PEOPLE:"люди",COMPANIES:"заведения",PLACES:"места",PLACEHOLDERLOGIN:"Телефон",PLACEHOLDERPASSWORD:"Пароль",PLACEHOLDERREPEATPASSWORD:"Повторите пароль",FORGOTPASSWORD:"Забыли пароль?",REGNEWUSER:"Регистрация нового пользователя",REMEMBERPASS:"Восстановление пароля",CHOOSEREMEMBERPASS:"Выберите способ восстановления пароля",NEXTBUTTON:"Вперед",NOTERECEIVECODE:"Если вы не получили код после 60 секунд",TRYMORE:"попробуйте еще",PLACEHOLDERCODE:"Введите код",PLACEHOLDERNEWPASSWORD:"Новый пароль",SAVEBUTTON:"Сохранить",ENTERNEWPASSWORD:"Введите новый пароль",USER:"Пользователь",COMPANY:"Заведение",REGISTERNOTICE:"Регистрируясь в нашем сервисе, вы получаете доступ к нашим услугам и подтверждаете согласие на обработку и хранение персональной информации",TERMSOFUSE:"пользовательское соглашение",PLACEHOLDERUSERNAME:"Имя пользователя",PLACEHOLDERPHONE:" Телефон",PLACEHOLDEREMAIL:"Email",START:"Начать работу без скачивания",REGNEWCOMPANY:"Регистрация нового заведения",SENDCODETOEMAIL:"Отправить код на email",PLACEHOLDERCOMPANYNAME:"Название компании"},"PLACEHOLDERREPEATPASSWORD","Повторите пароль"),_defineProperty(_$translateProvider$t2,"PLACEHOLDERCALLS","Номер для приема звонков"),_defineProperty(_$translateProvider$t2,"PLACEHOLDERADDRESS","Адрес"),_defineProperty(_$translateProvider$t2,"CHOOSECATEGORY","Выберите категорию"),_defineProperty(_$translateProvider$t2,"NIGHTCLUB","Ночной клуб"),_defineProperty(_$translateProvider$t2,"BAR","Бар"),_defineProperty(_$translateProvider$t2,"KARAOKE","Караоке"),_defineProperty(_$translateProvider$t2,"CAFE","Кафе"),_defineProperty(_$translateProvider$t2,"RESTAURANT","Ресторан"),_defineProperty(_$translateProvider$t2,"HOOKAH","Кальянная"),_defineProperty(_$translateProvider$t2,"HOSTEL","Гостиница"),_defineProperty(_$translateProvider$t2,"HOTEL","Отель"),_defineProperty(_$translateProvider$t2,"FITNESS","Фитнес"),_defineProperty(_$translateProvider$t2,"FASHION","Мода"),_defineProperty(_$translateProvider$t2,"ART","Искусство"),_defineProperty(_$translateProvider$t2,"GAMES","Игры"),_defineProperty(_$translateProvider$t2,"AQUAPARK","Аквапарк"),_defineProperty(_$translateProvider$t2,"SERVICE","Услуги"),_defineProperty(_$translateProvider$t2,"SHOPPING CENTER","Торговый центр"),_defineProperty(_$translateProvider$t2,"SHOP","Магазин"),_defineProperty(_$translateProvider$t2,"BUSINESS CENTER","Бизнес центр"),_defineProperty(_$translateProvider$t2,"KINDERGARTEN CENTER","Детский сад"),_defineProperty(_$translateProvider$t2,"EDUCATION","Образование"),_defineProperty(_$translateProvider$t2,"MEDICINE","Медицина"),_defineProperty(_$translateProvider$t2,"CHANNEL","Канал"),_defineProperty(_$translateProvider$t2,"PRIVATE","Частное"),_defineProperty(_$translateProvider$t2,"NO CATEGORY","Без категории"),_defineProperty(_$translateProvider$t2,"DOWNLOADWINDOWS","Скачать программу для Windows"),_defineProperty(_$translateProvider$t2,"DOWNLOADMAC","Скачать программу для Mac"),_defineProperty(_$translateProvider$t2,"SEARCHBYDIALOGS","Поиск по диалогам"),_defineProperty(_$translateProvider$t2,"SEARCHBYFAVORITES","Поиск по избранным"),_defineProperty(_$translateProvider$t2,"SEARCHBYFOLLOWERS","Поиск по подписчикам"),_defineProperty(_$translateProvider$t2,"ADDCAMERA","Добавить камеру"),_defineProperty(_$translateProvider$t2,"ADDCAMERANOTICE","Если вы используете статический IP адрес, добавьте URL Вашей камеры сюда и управляйте трансляцией с помощью мобильного приложения"),_defineProperty(_$translateProvider$t2,"PLACEHOLDERCAMERAURL","URL камеры"),_defineProperty(_$translateProvider$t2,"PLACEHOLDERCAMERANAME","Название камеры"),_defineProperty(_$translateProvider$t2,"ADDBUTTON","Добавить"),_defineProperty(_$translateProvider$t2,"SEARCHBYCAMERAS","Поиск по камерам"),_defineProperty(_$translateProvider$t2,"WALLNOTICE","Здесь вы можете разместить рекламу или афишу предстоящих событий"),_defineProperty(_$translateProvider$t2,"ADDWALL","Добавить стену"),_defineProperty(_$translateProvider$t2,"PLACEHOLDERWALLCREATETEXT","Введите текст"),_defineProperty(_$translateProvider$t2,"CREATEWALL","Создать стену"),_defineProperty(_$translateProvider$t2,"EDITWALL","Редактировать стену"),_defineProperty(_$translateProvider$t2,"UPDATEWALL","Обновить стену"),_defineProperty(_$translateProvider$t2,"DELETEWALL","Удалить стену"),_defineProperty(_$translateProvider$t2,"ANSWERTO","Ответить"),_defineProperty(_$translateProvider$t2,"WATCHERSCOUNT"," зрителей"),_defineProperty(_$translateProvider$t2,"WRITECOMMENT","Написать комментарий"),_defineProperty(_$translateProvider$t2,"DOWNLOAD","Скачать"),_defineProperty(_$translateProvider$t2,"DOWNLOADEYESTREAMER","Скачать EyeStreamer"),_defineProperty(_$translateProvider$t2,"DOWNLOADFORWINDOWS","Скачать для Windows"),_defineProperty(_$translateProvider$t2,"DOWNLOADFORMAC","Скачать для Mac"),_defineProperty(_$translateProvider$t2,"CHANGEPASSWORD","Изменить пароль"),_defineProperty(_$translateProvider$t2,"CHANGELOGINANDAVATAR","Изменить логин и аватар"),_defineProperty(_$translateProvider$t2,"ENTEROLDPASSWORD","Введите старый пароль"),_defineProperty(_$translateProvider$t2,"ENTERNEWPASSWORD","Введите новый пароль"),_defineProperty(_$translateProvider$t2,"ENTERLOGIN","Введите новый логин"),_defineProperty(_$translateProvider$t2,"CHANGEBUTTON","Изменить"),_$translateProvider$t2)),$translateProvider.preferredLanguage("ru_RU")}]),eyeApp.factory("httpInterceptor",function($q){return{request:function(config){return localStorage.getItem("access_token")&&(config.headers.Authorization="Bearer "+localStorage.getItem("access_token")),config}}}),eyeApp.config(function($httpProvider){$httpProvider.interceptors.push("httpInterceptor")}),eyeApp.config(function($routeProvider){$routeProvider.when("/auth",{templateUrl:"templates/auth.html",controller:"authController"}).when("/remember-pass",{templateUrl:"templates/remember-pass.html",controller:"authController"}).when("/reg",{templateUrl:"templates/reg.html",controller:"regController"}).when("/reg/user-reg",{templateUrl:"templates/user-reg.html",controller:"regController"}).when("/reg/company-reg",{templateUrl:"templates/company-reg.html",controller:"regController"}).when("/:reg",{templateUrl:"templates/reg.html",controller:"regController"}).otherwise({redirectTo:"/"})}),eyeApp.run(function($rootScope,$websocket){$rootScope.dataStream=$websocket("wss://newmedia.eyeinc.ru:84/one2many"),$rootScope.methods={get:function(){},enterChat:function(accessToken,idCorrespondent){$rootScope.dataStream.send(JSON.stringify({id:"enterChat",userId:idCorrespondent,access_token:accessToken}))},exitChat:function(accessToken,idCorrespondent){$rootScope.dataStream.send(JSON.stringify({id:"exitChat",userId:idCorrespondent,access_token:accessToken}))},chatTyping:function(accessToken,receiverId){$rootScope.dataStream.send(JSON.stringify({id:"chatTyping",access_token:accessToken,userId:receiverId}))},sendChatMessage:function(accessToken,receiverId,typeFile,message,messageAttachment,order){var request=JSON.stringify({id:"sendmessagetest",access_token:accessToken,userId:receiverId,type_file:typeFile,message:message,message_attachment:messageAttachment,order:order});$rootScope.dataStream.send(request)},translationStart:function(accessToken,sdpOffer,cameraId){$rootScope.dataStream.send(JSON.stringify({id:"translationStart",access_token:accessToken,sdpOffer:sdpOffer,cameraId:cameraId}))},translationStop:function(accessToken){$rootScope.dataStream.send(JSON.stringify({id:"translationStop",access_token:accessToken}))},sendIceCandidate:function(accessToken,candidate,cameraId){$rootScope.dataStream.send(JSON.stringify({id:"onIceCandidate",candidate:candidate,access_token:accessToken,cameraId:cameraId}))},sendComment:function(accessToken,ownerId,comment){$rootScope.dataStream.send(JSON.stringify({id:"sendComment",access_token:accessToken,userId:ownerId,comment:comment}))},callToUser:function(accessToken,calleeId,sdpOffer){$rootScope.dataStream.send(JSON.stringify({id:"callToUser",access_token:accessToken,userId:calleeId,sdpOffer:sdpOffer}))},sendResponse:function(response,accessToken,callId,sdpOffer){$rootScope.dataStream.send(JSON.stringify({id:"sendResponse",access_token:accessToken,callId:callId,sdpOffer:sdpOffer}))},endCall:function(status,accessToken,callId){$rootScope.dataStream.send(JSON.stringify({id:"endCall",access_token:accessToken,callId:callId,status:status}))},iceCandidateVideoCall:function(candidate,accessToken){$rootScope.dataStream.send(JSON.stringify({id:"onIceCandidateTest",access_token:accessToken,candidate:candidate}))},getCameraId:function(accessToken){$rootScope.dataStream.send(JSON.stringify({id:"getCameraId",access_token:accessToken}))},viewerStart:function(accessToken,sdpOffer,cameraId){$rootScope.dataStream.send(JSON.stringify({id:"viewer",access_token:accessToken,sdpOffer:sdpOffer,cameraId:cameraId}))},disconnectViewer:function(accessToken){$rootScope.dataStream.send(JSON.stringify({id:"disconnectViewer",access_token:accessToken}))},enterViewer:function(accessToken,presenterId){$rootScope.dataStream.send(JSON.stringify({id:"enterViewer",access_token:accessToken,userId:presenterId}))},exitViewer:function(accessToken,presenterId){$rootScope.dataStream.send(JSON.stringify({id:"exitViewer",access_token:accessToken,userId:presenterId}))},sendChangeQuality:function(accessToken,cameraId,quality){$rootScope.dataStream.send(JSON.stringify({id:"sendChangeQuality",access_token:accessToken,quality:quality,cameraId:cameraId}))}},$rootScope.obj={webSocket:$rootScope.dataStream,methods:$rootScope.methods}}),Socket.prototype={init:function($websocket){var _this=this;this.dataStream=$websocket("wss://newmedia.eyeinc.ru:84/one2many"),this.methods={get:function(){},enterChat:function(accessToken,idCorrespondent){_this.dataStream.send(JSON.stringify({id:"enterChat",userId:idCorrespondent,access_token:accessToken}))},exitChat:function(accessToken,idCorrespondent){_this.dataStream.send(JSON.stringify({id:"exitChat",userId:idCorrespondent,access_token:accessToken}))},chatTyping:function(accessToken,receiverId){_this.dataStream.send(JSON.stringify({id:"chatTyping",access_token:accessToken,userId:receiverId}))},sendChatMessage:function(accessToken,receiverId,typeFile,message,messageAttachment,order){var request=JSON.stringify({id:"sendmessagetest",access_token:accessToken,userId:receiverId,type_file:typeFile,message:message,message_attachment:messageAttachment,order:order});_this.dataStream.send(request)},translationStart:function(accessToken,sdpOffer,cameraId){_this.dataStream.send(JSON.stringify({id:"translationStart",access_token:accessToken,sdpOffer:sdpOffer,cameraId:cameraId}))},translationStop:function(accessToken){_this.dataStream.send(JSON.stringify({id:"translationStop",access_token:accessToken}))},sendIceCandidate:function(accessToken,candidate,cameraId){_this.dataStream.send(JSON.stringify({id:"onIceCandidate",candidate:candidate,access_token:accessToken,cameraId:cameraId}))},sendComment:function(accessToken,ownerId,comment){_this.dataStream.send(JSON.stringify({id:"sendComment",access_token:accessToken,userId:ownerId,comment:comment}))},callToUser:function(accessToken,calleeId,sdpOffer){_this.dataStream.send(JSON.stringify({id:"callToUser",access_token:accessToken,userId:calleeId,sdpOffer:sdpOffer}))},sendResponse:function(response,accessToken,callId,sdpOffer){_this.dataStream.send(JSON.stringify({id:"sendResponse",access_token:accessToken,callId:callId,sdpOffer:sdpOffer}))},endCall:function(status,accessToken,callId){_this.dataStream.send(JSON.stringify({id:"endCall",access_token:accessToken,callId:callId,status:status}))},iceCandidateVideoCall:function(candidate,accessToken){_this.dataStream.send(JSON.stringify({id:"onIceCandidateTest",access_token:accessToken,candidate:candidate}))},getCameraId:function(accessToken){_this.dataStream.send(JSON.stringify({id:"getCameraId",access_token:accessToken}))},viewerStart:function(accessToken,sdpOffer,cameraId){_this.dataStream.send(JSON.stringify({id:"viewer",access_token:accessToken,sdpOffer:sdpOffer,cameraId:cameraId}))},disconnectViewer:function(accessToken){_this.dataStream.send(JSON.stringify({id:"disconnectViewer",access_token:accessToken}))},enterViewer:function(accessToken,presenterId){_this.dataStream.send(JSON.stringify({id:"enterViewer",access_token:accessToken,userId:presenterId}))},exitViewer:function(accessToken,presenterId){_this.dataStream.send(JSON.stringify({id:"exitViewer",access_token:accessToken,userId:presenterId}))},sendChangeQuality:function(accessToken,cameraId,quality){_this.dataStream.send(JSON.stringify({id:"sendChangeQuality",access_token:accessToken,quality:quality,cameraId:cameraId}))}}}},Socket.get=function(){return new Socket},eyeApp.factory("socketService",function(){return{get:Socket.get}}),eyeApp.controller("mainController",function($http,$scope,$window,$translate,$location){$scope.isClose=!0,$scope.currentStep=0,$scope.isShowAccountPanel=!1,$scope.isShowTop=!1,$scope.isStartTranslation=!1,$location.search().reg&&($scope.isClose=!1,$location.url("reg")),$scope.showStep=function(step){var x=document.getElementsByClassName("step");x[step].style.display="block",0==step?angular.element("#prev").css("display","none"):angular.element("#prev").css("display","inline-block"),step==x.length-1?angular.element("#prev").css("display","none"):angular.element(".step button").css("visibility","visible")},$scope.nextStep=function(step){var x=document.getElementsByClassName("step");if(x[$scope.currentStep].style.display="none",$scope.currentStep=$scope.currentStep+step,$scope.currentStep>=x.length)return!1;$scope.showStep($scope.currentStep)},$scope.setLang=function(langKey){$translate.use(langKey)},$scope.makeCodeRequest=function(){$http({url:"https://api.eyeinc.ru/v0.9/index.php?c=api&m=rememberPasswordStart",method:"GET",params:{login:$scope.login},headers:{"Content-Type":"application/x-www-form-urlencoded",Accept:"/"}}).then(function(result){alert("СМС с кодом отправлено")})},$scope.toggleElement=function(toggle,isReload){$scope.isClose=toggle,isReload&&($window.location.href="/"),$scope.isShowTop=!1},$scope.showAccountPanel=function(){$scope.isShowAccountPanel=!$scope.isShowAccountPanel,$scope.isShowTop=!1,$scope.isOpenChat=!1,$scope.isShowAccountPanel||($scope.panelType=!1,angular.element("#userPanel nav ul").removeAttr("data-clicked"),angular.element("footer").show()),$scope.isShowTop?(angular.element(".openToggle i").removeClass("icon-eye-closetop"),angular.element(".openToggle i").addClass("icon-eye-opentop")):(angular.element(".openToggle i").removeClass("icon-eye-opentop"),angular.element(".openToggle i").addClass("icon-eye-closetop"))},$scope.showTop=function(){$scope.isShowTop=!$scope.isShowTop,$scope.userId=!1,$scope.panelType=!1,$scope.modalType=!1,angular.element("#userPanel nav ul").removeAttr("data-clicked"),map.addListener("zoom_changed",function(){getMarkers(map)}),$scope.isShowTop?($scope.isShowAccountPanel=!1,angular.element(".openToggle i").removeClass("icon-eye-closetop"),angular.element(".openToggle i").addClass("icon-eye-opentop")):(angular.element(".openToggle i").removeClass("icon-eye-opentop"),angular.element(".openToggle i").addClass("icon-eye-closetop"))},$scope.refreshAccessToken=function(callback){$http({url:"https://api.eyeinc.ru/v0.9/index.php?c=api&m=refreshaccesstoken",method:"POST",data:$.param({refresh_token:localStorage.getItem("refresh_token"),client_id:"web",client_secret:"EvZ5pWaVAhvC7laJdFNTNsrQLNaeF2"}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(result){if(result.data.success){var auth=result.data.auth;localStorage.setItem("access_token",auth.access_token),localStorage.setItem("refresh_token",auth.refresh_token),callback(!0)}else callback(!1)}).catch(function(reject){console.log(reject),callback(!1)})},$scope.getUserDataById=function(id){$http({url:"https://api.eyeinc.ru/v0.9/index.php?c=api&m=getUserPage",method:"GET",params:{id:id}}).then(function(result){for(var prop in result.data.profile.followeTo)if(result.data.profile.followeTo[prop].id==localStorage.getItem("user_id")){$scope.isSubscirbe="подписан на вас";break}for(var prop in result.data.profile.followeMe){if(result.data.profile.followeMe[prop].id==localStorage.getItem("user_id")){$scope.isFollow=!0;break}$scope.isFollow=!1}$scope.userId=result.data.profile.id,$scope.userAvatar=result.data.profile.avatar,$scope.userType=result.data.profile.type,$scope.userName=result.data.profile.name,$scope.isOnline=result.data.profile.online,$scope.userLikes=result.data.profile.likes,$scope.userFollowers=result.data.profile.followeMe.length,$scope.userFavorites=result.data.profile.followeTo.length,"0"==result.data.profile.translation?$scope.notTranslate=!0:$scope.notTranslate=!1,$scope.getWallByUserId(id),$scope.getFavoritesByUserId(id),$scope.getFollowersByUserId(id)})},$scope.startTranslation=function(isStartTranslation,type,userType,cameraId,accountProfileId,cameraClient){$scope.isStartTranslation=isStartTranslation,$scope.isOpenChat=!1,$scope.isShowTop=!1,$scope.isShowAccountPanel=!1,$scope.panelType=!1,$scope.translationType=type,$scope.userType=userType,$scope.cameraId=cameraId,$scope.ownerId=accountProfileId,$scope.cameraClient=cameraClient,"Presenter"==$scope.translationType&&($scope.userId="")},$scope.enterUserTranslation=function(id){$http({url:"https://api.eyeinc.ru/v0.9/index.php?c=api&m=getUserPage",method:"GET",params:{id:id}}).then(function(result){$scope.userTranslationName=result.data.profile.name,$scope.cameraClient=result.data.profile.cameras[0].client,$scope.userTranslationId=result.data.profile.id,$scope.ownerId=id,$scope.cameras=result.data.profile.cameras,0!=$scope.userTranslationType?$scope.startTranslation(!0,"Viewer",$scope.userTranslationType,$scope.cameras[0].id,$scope.userTranslationId,$scope.cameraClient):alert("Просмотр трансляций уличных камер возможен только через приложение")},function(response){401==response.status&&alert("Вы должны авторизоваться для просмотра трансляций")})}}),eyeApp.directive("panel",function(){return{restrict:"E",replace:!0,link:function(scope,element,attrs){scope.showPanel=function(panelType){switch(panelType){case"dialogs":scope.panelType="templates/directives/dialogs.html",angular.element("#panel").hasClass("ng-hide")?isMobileDevice()?angular.element("#chat").css({marginLeft:MOBILELEFTASIDEWIDTH+INFOPANELWIDTH,width:angular.element("body").outerWidth()-MOBILELEFTASIDEWIDTH-INFOPANELWIDTH-RIGHTASIDEWIDTH}):angular.element("#chat").css({marginLeft:LEFTASIDEWIDTH+INFOPANELWIDTH,width:angular.element("body").outerWidth()-LEFTASIDEWIDTH-INFOPANELWIDTH-RIGHTASIDEWIDTH}):isMobileDevice()?angular.element("#chat").css({marginLeft:MOBILELEFTASIDEWIDTH,width:angular.element("body").outerWidth()-MOBILELEFTASIDEWIDTH-RIGHTASIDEWIDTH}):angular.element("#chat").css({marginLeft:LEFTASIDEWIDTH,width:angular.element("body").outerWidth()-LEFTASIDEWIDTH-RIGHTASIDEWIDTH}),scope.getChatList();break;case"cameras":scope.panelType="templates/directives/cameras.html",scope.isOpenChat=!1,scope.getMyCameras();break;case"favorites":scope.panelType="templates/directives/favorites.html",scope.isOpenChat=!1,scope.getMyFavorites();break;case"followers":scope.panelType="templates/directives/followers.html",scope.isOpenChat=!1,scope.getMyFollowers();break;case"wall":scope.panelType="templates/directives/wall.html",scope.isOpenChat=!1;break;case"settings":scope.panelType="templates/directives/settings.html",scope.isOpenChat=!1;break;case"search":scope.panelType="templates/directives/search.html",scope.isOpenChat=!1}}},template:"<div data-ng-include='panelType' data-ng-if='panelType' data-ng-cloak></div>",controller:"userController"}}),eyeApp.directive("modal",function(){return{restrict:"E",replace:!0,transclude:!0,link:function(scope,element,attrs){scope.showModal=function(modalType){switch(scope.isClose=!1,scope.panelType=!1,scope.isOpenChat=!1,scope.isShowTop=!1,modalType){case"addCamera":scope.modalType="templates/directives/addCamera.html";break;case"settings":scope.modalType="templates/directives/settings.html";break;case"download":scope.modalType="templates/directives/download.html"}}},template:"<div data-ng-if='modalType && !isClose' data-ng-cloak><button data-ng-click='toggleElement(true, false)'>&times;</button><div class='modalWrapper' data-ng-include='modalType'></div></div>",controller:"userController"}}),eyeApp.directive("lightbox",function(){return{restrict:"E",replace:!0,transclude:!0,link:function(scope,element){scope.openLightBox=function(source){scope.isOpenLightBox=!0,scope.isClose=!1,scope.source=source}},templateUrl:"templates/directives/lightbox.html"}}),eyeApp.directive("file",function(){return{restrict:"A",link:function(scope,element){element.bind("change",function(event){var str,file=event.target.files[0],reader=new FileReader;file?reader.readAsDataURL(file):(angular.element("#newAvatar").removeAttr("src"),angular.element("#newAvatar").hide()),reader.onloadend=function(){var $image=angular.element("#newAvatar");$image.css("display","block"),$image.attr("src",reader.result),$image.cropper("destroy"),$image.cropper({aspectRatio:4/3,viewMode:3,cropBoxResizable:!1,dragMode:"move",toggleDragModeOnDblclick:!1,crop:function(event){str=cropper.getCroppedCanvas({width:640,height:480}).toDataURL(),scope.base64=str}});var cropper=$image.data("cropper")}})}}});